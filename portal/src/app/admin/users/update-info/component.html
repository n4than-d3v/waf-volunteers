<a class="back-link" [routerLink]="'../../'">Back</a>

<h1>User</h1>
@if (loading$ | async) {
<spinner></spinner>
} @if (error$ | async) {
<div class="error">Error occurred</div>
} @if (updated$ | async) {
<div class="success">User updated</div>
}
<form [formGroup]="form">
  @if (beaconForm && profile && profile.beaconInfo) {
  <beacon-info [form]="beaconForm" [profile]="profile.beaconInfo" />
  <div class="summary-card">
    <div class="summary-card__title-wrapper">
      <h2 class="summary-card__title">Cars</h2>
    </div>
    <div class="summary-card__content">
      <div *ngIf="editing !== 'cars'">
        <dl class="summary-list">
          <div
            *ngFor="let car of form.controls.cars.controls; let i=index"
            class="summary-list__row"
          >
            <dt class="summary-list__key">Car {{ i + 1 }}</dt>
            <dd class="summary-list__value">{{ car.value }}</dd>
          </div>
          @if (form.controls.cars.controls.length === 0) {
          <p class="no-cars">
            Please provide your car registration number(s) if you drive to
            Wildlife Aid. You are asked on arrival which car you came in, in
            case of emergencies.
          </p>
          }
        </dl>
        <div class="right">
          <button class="button button--secondary" (click)="editing = 'cars'">
            Update
          </button>
        </div>
      </div>
      <div *ngIf="editing === 'cars'" formGroupName="cars">
        <div
          class="car-field"
          *ngFor="let car of form.controls.cars.controls; let i=index"
        >
          <div class="text-with-button">
            <input type="text" [formControlName]="i" />
            <button class="button button--warning" (click)="removeCar(i)">
              Remove
            </button>
          </div>
        </div>
        <button class="button button--secondary add-another" (click)="addCar()">
          Add {{ (form.controls.cars.length === 0 ? 'a' : 'another' )}} car
        </button>
      </div>
    </div>
  </div>
  <br />
  } @else {
  <div class="field">
    <label for="firstName">First name</label>
    <input
      type="text"
      id="firstName"
      name="firstName"
      formControlName="firstName"
    />
  </div>
  <div class="field">
    <label for="lastName">Last name</label>
    <input
      type="text"
      id="lastName"
      name="lastName"
      formControlName="lastName"
    />
  </div>
  <br />
  <h2>Contact details</h2>
  <div class="field">
    <label for="email">Email</label>
    <input type="text" id="email" name="email" formControlName="email" />
  </div>
  <br />
  }
  <h2>Status</h2>
  <div class="field">
    <label for="status-active">Active</label>
    <input
      type="radio"
      id="status-active"
      name="status"
      formControlName="status"
      [value]="0"
    />
  </div>
  <div class="field">
    <label for="status-inactive">Inactive</label>
    <input
      type="radio"
      id="status-inactive"
      name="status"
      formControlName="status"
      [value]="1"
    />
  </div>
  <div class="field">
    <label for="status-on-hold">On hold</label>
    <input
      type="radio"
      id="status-on-hold"
      name="status"
      formControlName="status"
      [value]="2"
    />
  </div>
  <br />
  <h2>Access</h2>
  <div formGroupName="roles">
    @for (role of roles; track role.value) { @if (role.value) {
    <div class="field">
      <label for="role-{{ role.name }}">{{ role.display }}</label>
      <input
        type="checkbox"
        id="role-{{ role.name }}"
        name="role-{{ role.name }}"
        [formControlName]="role.name"
      />
    </div>
    } }
  </div>
  <button class="button button--primary" (click)="save()">Save</button>
</form>
