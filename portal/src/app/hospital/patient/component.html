@if (patient$ | async; as patient) { @if (patient.loading) {
<spinner />
} @else if (patient.error) {
<div class="error">Error occurred</div>
} @else if (patient.data) { @if (patient.data.status ===
PatientStatus.PendingInitialExam) {
<p>
  This patient has not yet been examined.<br />
  Please perform the intake exam in order to view and modify the full patient
  record.
</p>
<section>
  <h3>Admission</h3>
  <div class="row">
    <table>
      <tbody>
        <tr>
          <td>Reference</td>
          <td>{{ patient.data.reference }}</td>
        </tr>
        <tr>
          <td>Suspected species</td>
          <td>{{ patient.data.suspectedSpecies.description }}</td>
        </tr>
        <tr>
          <td>Initial location</td>
          <td>{{ patient.data.initialLocation.description }}</td>
        </tr>
        <tr>
          <td>Admission reason</td>
          <td>{{ formatAdmissionReasons(patient.data) }}</td>
        </tr>
        <tr>
          <td>Date admitted</td>
          <td>{{ patient.data.admitted | date: 'dd MMM yyyy HH:mm' }}</td>
        </tr>
      </tbody>
    </table>
    <table>
      <tbody>
        <tr>
          <td>Found at</td>
          <td>{{ patient.data.foundAt }}</td>
        </tr>
        @if (patient.data.admitter) {
        <tr>
          <td>Admitted by</td>
          <td>{{ patient.data.admitter.fullName }}</td>
        </tr>
        <tr>
          <td>Address</td>
          <td>{{ patient.data.admitter.address }}</td>
        </tr>
        <tr>
          <td>Email</td>
          <td>{{ patient.data.admitter.email }}</td>
        </tr>
        <tr>
          <td>Telephone</td>
          <td>{{ patient.data.admitter.telephone }}</td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</section>
<section>
  <h3>Intake exam</h3>
  <form [formGroup]="examForm">
    <div class="exam-section">
      <h4>Identification</h4>
      <div class="fields">
        <div class="field">
          <label for="species">Species</label>
          <select id="species" formControlName="speciesId">
            <option value=""></option>
            @if (species$ | async; as specieses) { @if (specieses.loading) {
            <spinner />
            } @else if (specieses.error) {
            <div class="error">Error occurred</div>
            } @else if (specieses.data) { @for (species of specieses.data; track
            species.id) {
            <option [value]="species.id">{{ species.name }}</option>
            } }}
          </select>
        </div>
        <div class="field">
          <label for="age">Age</label>
          <select id="age" formControlName="speciesAgeId">
            <option value=""></option>
            @if (species$ | async; as specieses) { @if (specieses.loading) {
            <spinner />
            } @else if (specieses.error) {
            <div class="error">Error occurred</div>
            } @else if (specieses.data) { @for (species of specieses.data; track
            species.id) { @if (species.id.toString() ==
            examForm.controls.speciesId.value) { @for (age of species.ages;
            track age.id) {
            <option [value]="age.id">{{ age.name }}</option>
            } }} }}
          </select>
        </div>
        <div class="field">
          <label for="sex">Sex</label>
          <select id="sex" formControlName="sex">
            <option value="1">Male</option>
            <option value="2">Female</option>
            <option value="3">Unknown</option>
          </select>
        </div>
      </div>
    </div>
    <div class="exam-section">
      <h4>Condition</h4>
      <div class="fields">
        <div class="field">
          <label for="weight">Weight</label>
          <div class="input-with-units">
            <input
              id="weight"
              type="text"
              formControlName="weightValue"
              autocomplete="off"
            />
            <select id="weightUnit" formControlName="weightUnit">
              <option value="1">g</option>
              <option value="2">kg</option>
              <option value="3">oz</option>
              <option value="4">lbs</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="temperature">Temperature</label>
          <div class="input-with-units">
            <input
              id="temperature"
              type="text"
              formControlName="temperatureValue"
              autocomplete="off"
            />
            <select id="temperatureUnit" formControlName="temperatureUnit">
              <option value="1">C</option>
              <option value="2">F</option>
            </select>
          </div>
        </div>
      </div>
      <div class="fields">
        <div class="field">
          <label for="attitude">Attitude</label>
          <select id="attitude" formControlName="attitudeId">
            <option value=""></option>
            @if (attitudes$ | async; as attitudes) { @if (attitudes.loading) {
            <spinner />
            } @else if (attitudes.error) {
            <div class="error">Error occurred</div>
            } @else if (attitudes.data) { @for (attitude of attitudes.data;
            track attitude.id) {
            <option [value]="attitude.id">{{ attitude.description }}</option>
            } }}
          </select>
        </div>
        <div class="field">
          <label for="bodyCondition">Body condition</label>
          <select id="bodyCondition" formControlName="bodyConditionId">
            <option value=""></option>
            @if (bodyConditions$ | async; as bodyConditions) { @if
            (bodyConditions.loading) {
            <spinner />
            } @else if (bodyConditions.error) {
            <div class="error">Error occurred</div>
            } @else if (bodyConditions.data) { @for (bodyCondition of
            bodyConditions.data; track bodyCondition.id) {
            <option [value]="bodyCondition.id">
              {{ bodyCondition.description }}
            </option>
            } }}
          </select>
        </div>
        <div class="field">
          <label for="dehydration">Dehydration</label>
          <select id="dehydration" formControlName="dehydrationId">
            <option value=""></option>
            @if (dehydrations$ | async; as dehydrations) { @if
            (dehydrations.loading) {
            <spinner />
            } @else if (dehydrations.error) {
            <div class="error">Error occurred</div>
            } @else if (dehydrations.data) { @for (dehydration of
            dehydrations.data; track dehydration.id) {
            <option [value]="dehydration.id">
              {{ dehydration.description }}
            </option>
            } }}
          </select>
        </div>
      </div>
      <div class="fields">
        <div class="field">
          <label for="mucousMembraneColour">Mucous membrane colour</label>
          <select
            id="mucousMembraneColour"
            formControlName="mucousMembraneColourId"
          >
            <option value=""></option>
            @if (mucousMembraneColours$ | async; as mucousMembraneColours) { @if
            (mucousMembraneColours.loading) {
            <spinner />
            } @else if (mucousMembraneColours.error) {
            <div class="error">Error occurred</div>
            } @else if (mucousMembraneColours.data) { @for (mucousMembraneColour
            of mucousMembraneColours.data; track mucousMembraneColour.id) {
            <option [value]="mucousMembraneColour.id">
              {{ mucousMembraneColour.description }}
            </option>
            } }}
          </select>
        </div>
        <div class="field">
          <label for="mucousMembraneTexture">Mucous membrane texture</label>
          <select
            id="mucousMembraneTexture"
            formControlName="mucousMembraneTextureId"
          >
            <option value=""></option>
            @if (mucousMembraneTextures$ | async; as mucousMembraneTextures) {
            @if (mucousMembraneTextures.loading) {
            <spinner />
            } @else if (mucousMembraneTextures.error) {
            <div class="error">Error occurred</div>
            } @else if (mucousMembraneTextures.data) { @for
            (mucousMembraneTexture of mucousMembraneTextures.data; track
            mucousMembraneTexture.id) {
            <option [value]="mucousMembraneTexture.id">
              {{ mucousMembraneTexture.description }}
            </option>
            } }}
          </select>
        </div>
      </div>
    </div>
    <div class="exam-section">
      <h4>Treatments</h4>
      <p>
        List medications administered and other treatments performed on intake.
      </p>
      <div class="buttons">
        <button class="button button--secondary">Add medication</button>
        <button class="button button--secondary">Add treatment</button>
      </div>
    </div>
    <div class="exam-section">
      <h4>Comments</h4>
      <div class="fields">
        <div class="field">
          <textarea
            id="comments"
            formControlName="comments"
            rows="2"
            autocomplete="off"
          ></textarea>
        </div>
      </div>
    </div>
  </form>
  <div class="exam-section">
    <h4>Outcome</h4>
    <p>Patient...</p>
    <div class="field">
      <label for="alive">is alive</label>
      <input type="radio" id="alive" [(ngModel)]="outcome" value="alive" />
    </div>
    <div class="field">
      <label for="deadOnArrival">was dead on arrival</label>
      <input
        type="radio"
        id="deadOnArrival"
        [(ngModel)]="outcome"
        value="deadOnArrival"
      />
    </div>
    <div class="field">
      <label for="pts">was put to sleep</label>
      <input type="radio" id="pts" [(ngModel)]="outcome" value="pts" />
    </div>
    @if (outcome !== 'alive') {
    <div class="fields">
      <div class="field">
        <label for="dispositionReason">Disposition reason</label>
        <select id="dispositionReason" [(ngModel)]="dispositionReasonId">
          <option value=""></option>
          @if (dispositionReasons$ | async; as dispositionReasons) { @if
          (dispositionReasons.loading) {
          <spinner />
          } @else if (dispositionReasons.error) {
          <div class="error">Error occurred</div>
          } @else if (dispositionReasons.data) { @for (dispositionReason of
          dispositionReasons.data; track dispositionReason.id) {
          <option [value]="dispositionReason.id">
            {{ dispositionReason.description }}
          </option>
          } }}
        </select>
      </div>
    </div>
    }
  </div>
  <!--
  public int PatientId { get; set; }
public int SpeciesId { get; set; }
public int SpeciesAgeId { get; set; }
public Sex Sex { get; set; }
public decimal? WeightValue { get; set; }
public WeightUnit? WeightUnit { get; set; }
public decimal? TemperatureValue { get; set; }
public TemperatureUnit? TemperatureUnit { get; set; }
public int? AttitudeId { get; set; }
public int? BodyConditionId { get; set; }
public int? DehydrationId { get; set; }
public int? MucousMembraneColourId { get; set; }
public int? MucousMembraneTextureId { get; set; }
public List<TreatmentInstruction> TreatmentInstructions { get; set; }
public List<TreatmentMedication> TreatmentMedications { get; set; }
public string Comments { get; set; }
--></section>
} } }
