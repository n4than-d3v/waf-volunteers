<div class="buttons">
  @for (request of patient.homeCareRequests; track request.id) { @if
  (!request.dropoff) {
  <button
    (click)="homeCareDropOff(request.id)"
    class="button button--secondary-invert"
  >
    ğŸ  Home carer returned patient
  </button>
  } }
</div>
<form [formGroup]="messageForm">
  @if (patient.homeCareMessages.length > 0) {
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Author</th>
        <th>Message</th>
      </tr>
    </thead>
    <tbody>
      @for (message of patient.homeCareMessages; track message.id) {
      <tr>
        <td>{{ message.date | date: 'dd MMM yyyy HH:mm' }}</td>
        <td>{{ message.author.firstName }} {{ message.author.lastName }}</td>
        <td>{{ message.message }}</td>
      </tr>
      }
    </tbody>
  </table>
  } @else {
  <p><em>No messages have been sent for this patient.</em></p>
  }
  <div class="flex">
    @if (patient.status != PatientStatus.Dispositioned) {
    <div class="field">
      <label for="message">Message home carer</label>
      <textarea
        id="message"
        type="text"
        formControlName="message"
        autocomplete="off"
        rows="3"
      ></textarea>
    </div>
    @if (!saving) {
    <div class="buttons">
      @for (request of patient.homeCareRequests; track request.id) { @if
      (!request.dropoff) {
      <button
        (click)="sendMessage(request.id)"
        class="button button--secondary-invert"
      >
        ğŸ’¬ Send
      </button>
      } }
    </div>
    } }
  </div>
</form>
@if (dropOffTask$ | async; as task) { @if (task.loading) {
<spinner></spinner>
} @else if (task.error) {
<div class="error">Error occurred</div>
} } @if (messageTask$ | async; as task) { @if (task.loading) {
<spinner></spinner>
} @else if (task.error) {
<div class="error">Error occurred</div>
} }
