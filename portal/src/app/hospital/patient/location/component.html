<div class="row">
  <table>
    <tbody>
      <tr>
        <td>Pen</td>
        <td>{{ patient.pen?.reference || '(blank)' }}</td>
      </tr>
    </tbody>
  </table>
</div>
@if (patient.movements.length > 0) {
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>From</th>
      <th>To</th>
    </tr>
  </thead>
  <tbody>
    @for (movement of patient.movements; track movement.id) {
    <tr>
      <td>{{ movement.moved | date: 'EEEE, dd MMM yyyy HH:mm' }}</td>
      <td>{{ movement.from.reference }}</td>
      <td>{{ movement.to.reference }}</td>
    </tr>
    }
  </tbody>
</table>
} @if (!moving) { @if (patient.status != PatientStatus.Dispositioned) {
<div class="buttons">
  <button (click)="moving = true" class="button button--secondary-invert">
    üìç Move
  </button>
</div>
} } @else {
<form [formGroup]="moveForm">
  <div class="field">
    <label for="area">
      Area
      <span class="required">*</span>
    </label>
    <select id="area" formControlName="areaId">
      <option value=""></option>
      @if (areas$ | async; as areas) { @if (areas.loading) {
      <spinner />
      } @else if (areas.error) {
      <div class="error">Error occurred</div>
      } @else if (areas.data) { @for (area of areas.data; track area.id) {
      <option [value]="area.id">{{ area.name }}</option>
      } }}
    </select>
  </div>
  <div class="field">
    <label for="pen">
      Pen
      <span class="required">*</span>
    </label>
    <select id="pen" formControlName="penId">
      <option value=""></option>
      @if (areas$ | async; as areas) { @if (areas.loading) {
      <spinner />
      } @else if (areas.error) {
      <div class="error">Error occurred</div>
      } @else if (areas.data) { @for (area of areas.data; track area.id) { @if
      (area.id.toString() == moveForm.value.areaId) { @for (pen of area.pens;
      track pen.id) {
      <option [value]="pen.id">{{ pen.code }}</option>
      } } } }}
    </select>
  </div>
  @if (!saving) { @if (attemptedSave && !moveForm.valid) {
  <div class="error">Please fill in all required fields</div>
  }
  <div class="buttons">
    <button (click)="move()" class="button button--primary">Save</button>
    <button (click)="reset()" class="button button--secondary">Back</button>
  </div>
  }
</form>
} @if (task$ | async; as task) { @if (task.loading) {
<spinner></spinner>
} @else if (task.error) {
<div class="error">Error occurred</div>
} }
