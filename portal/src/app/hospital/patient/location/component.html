<div class="row">
  <table>
    <tbody>
      <tr>
        <td>Pen</td>
        <td>{{ patient.pen?.reference || '(blank)' }}</td>
      </tr>
    </tbody>
  </table>
</div>
@if (patient.movements.length > 0) {
<table>
  <thead>
    <tr>
      <th>Date</th>
      <th>From</th>
      <th>To</th>
    </tr>
  </thead>
  <tbody>
    @for (movement of patient.movements; track movement.id) {
    <tr>
      <td>{{ movement.moved | date: 'dd MMM yyyy HH:mm' }}</td>
      <td>{{ movement.from.reference }}</td>
      <td>{{ movement.to.reference }}</td>
    </tr>
    }
  </tbody>
</table>
} @if (!moving) { @if (isVet && patient.status != PatientStatus.Dispositioned) {
<div class="buttons">
  <button (click)="moving = true" class="button button--secondary-invert">
    üìç Move
  </button>
</div>
} } @else {
<form [formGroup]="moveForm">
  <div class="field">
    <label for="area">
      Area
      <span class="required">*</span>
    </label>
    @if (areas$ | async; as areas) { @if (areas.loading) {
    <spinner />
    } @else if (areas.error) {
    <div class="error">Error occurred</div>
    } @else if (areas.data) {
    <hospital-patient-autocomplete
      [id]="'areaId'"
      [inline]="true"
      [label]="''"
      [control]="'areaId'"
      [formGroup]="moveForm"
      [items]="convertAreas(areas.data)"
    ></hospital-patient-autocomplete>
    } }
  </div>
  <div class="field">
    <label for="pen">
      Pen
      <span class="required">*</span>
    </label>
    @if (areas$ | async; as areas) { @if (areas.loading) {
    <spinner />
    } @else if (areas.error) {
    <div class="error">Error occurred</div>
    } @else if (areas.data) {
    <hospital-patient-autocomplete
      [id]="'penId'"
      [inline]="true"
      [label]="''"
      [control]="'penId'"
      [formGroup]="moveForm"
      [items]="convertPens(areas.data)"
    ></hospital-patient-autocomplete>
    } }
  </div>
  <div class="field">
    <label for="movingPenToAnotherArea">
      Moving this pen into another area
    </label>
    <input
      type="checkbox"
      id="movingPenToAnotherArea"
      formControlName="movingPenToAnotherArea"
    />
  </div>
  @if (moveForm.value.movingPenToAnotherArea) {
  <div class="field">
    <label for="newAreaId">
      New area
      <span class="required">*</span>
    </label>
    @if (areas$ | async; as areas) { @if (areas.loading) {
    <spinner />
    } @else if (areas.error) {
    <div class="error">Error occurred</div>
    } @else if (areas.data) {
    <hospital-patient-autocomplete
      [id]="'newAreaId'"
      [inline]="true"
      [label]="''"
      [control]="'newAreaId'"
      [formGroup]="moveForm"
      [items]="convertAreas(areas.data, false)"
    ></hospital-patient-autocomplete>
    } }
  </div>
  } @if (!saving) { @if (attemptedSave && !moveForm.valid) {
  <div class="error">Please fill in all required fields</div>
  }
  <div class="buttons">
    <button (click)="move()" class="button button--primary">Save</button>
    <button (click)="reset()" class="button button--secondary">Back</button>
  </div>
  }
</form>
} @if (task$ | async; as task) { @if (task.loading) {
<spinner></spinner>
} @else if (task.error) {
<div class="error">Error occurred</div>
} }
